<?xml version="1.0" encoding="utf-8"?>
<mx:VBox horizontalAlign="center"
	xmlns:mx="http://www.adobe.com/2006/mxml"
	creationComplete="refresh()" width="100%" height="100%">
	<mx:HTTPService id="reportSvc" 
		useProxy="false"
		method="GET"
		url="{svcUrl.devStateSvcUrl}"
		result="httpResultHandler(event)"
		fault="httpFaultHandler(event)"/>
	<mx:Script>
		<![CDATA[
			import components.SvcUrl;
			import mx.managers.PopUpManager;
			import components.util.ReloaderPopup;
			import components.Util;
			import mx.collections.ArrayCollection;
			
			[Bindable]			
			public var devicesState:ArrayCollection = new ArrayCollection();
			
			public function refresh():void{
				reportSvc.cancel();
				reportSvc.send(null);
			}			
			
			var util:Util = new Util();
			var svcUrl:SvcUrl = new SvcUrl();
			function httpFaultHandler(event:*):void {
				var p:ReloaderPopup = new ReloaderPopup();
				p.width = this.width;
				p.height = this.height
				PopUpManager.addPopUp(p, this, true);
			}
			
			function httpResultHandler(event:*):void {
				if (event.result.internalServerError != null) {
					httpFaultHandler(event);
					return;
				}
				devicesState = event.result.availableDevicesReport;
			}			
		]]>
	</mx:Script>
		
	<mx:VBox
		width="100%"
		height="100%">
		<mx:PieChart 
			id="piechart"
			width="100%"
			height="100%"
			visible="true"
			showDataTips="true">
			<mx:series>
				<mx:PieSeries displayName="Состояние устройств" 
					field="amount"
					nameField="type"
					dataProvider="{devicesState}">
					<mx:fills>
                       <mx:SolidColor color="green" alpha="0.8" />
                       <mx:SolidColor color="red" alpha="0.2" />
                       <mx:SolidColor color="yellow" alpha="0.5" />
	                </mx:fills>
				</mx:PieSeries>					
			</mx:series>
		</mx:PieChart>		
	</mx:VBox>
</mx:VBox>
