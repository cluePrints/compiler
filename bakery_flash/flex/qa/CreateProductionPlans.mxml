<?xml version="1.0" encoding="utf-8"?>
<mx:VBox horizontalAlign="center"
	xmlns:mx="http://www.adobe.com/2006/mxml"
	creationComplete="refresh()" width="100%" height="100%">
	<mx:HTTPService id="moneyMoveSvc" 
		useProxy="false"
		method="GET"
		url="{svcUrl.moneyMoveSvcUrl}"
		result="httpResultHandler(event)"
		fault="util.httpFaultHandler(event)"/>
	<mx:Script>
		<![CDATA[
			import components.SvcUrl;
			import mx.managers.PopUpManager;
			import components.util.ReloaderPopup;
			import components.Util;
			import mx.collections.ArrayCollection;
			
			[Bindable]			
			private var allOrders:ArrayCollection = new ArrayCollection();
			public var orderStatuses:ArrayCollection = new ArrayCollection();
			public var mainDataSvcUrl:String;
			public function refresh():void{
				reportSvc.cancel();
				reportSvc.send(null);
			}				
			
			var util:Util = new Util();
			var svcUrl:SvcUrl = new SvcUrl();
			
			function httpResultHandler(event:*):void {
				if (event.result.internalServerError != null) {
					util.httpFaultHandler(event);
					return;
				}
			}		
			function stateToString(item:Object, column:DataGridColumn):String{
				var tmp = util.getItemById(orderStatuses, item.id);
				if (tmp == null) {
					return "Новый";
				} else {
					if (tmp.done) {
						return "Выполнен полностью";
					}
					if (tmp.produced){
						return "Готов к отгрузке";
					}
					if (tmp.payed){
						return "Оплачен";
					}
					return "Не оплачен";				
				}					
			}	
		]]>
	</mx:Script>
		
	<mx:VBox
		width="100%"
		height="100%">
		<mx:DataGrid
			dataProvider="{allOrders}"
			id="dgOrders">
			<mx:columns>
				<mx:DataGridColumn headerText="id" dataField="id" width="25"/>
				<mx:DataGridColumn headerText="Заказ" dataField="textView" width="400"/>
				<mx:DataGridColumn headerText="Состояние" labelFunction="stateToString" width="200"/>			
			</mx:columns>
		</mx:DataGrid>
		<mx:Button
			label="Создать план загрузки оборудования"
			enabled="{dgOrders.selectedItem!=null &amp;&amp; stateToString(dgOrders.selectedItem, null)==&quot;Оплачен&quot;}"/>
	</mx:VBox>
</mx:VBox>
