<?xml version="1.0" encoding="UTF-8"?>
<flow xmlns="http://www.springframework.org/schema/webflow"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow http://www.springframework.org/schema/webflow/spring-webflow-1.0.xsd">

	<start-state idref="orderForm" />
	
	<view-state id="productMoveForm" view="admin/productMoveForm">
		<render-actions>
			<action bean="productMoveFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="productMoveForm">
			<action bean="productMoveFormAction" method="bindAndValidate"/>
			<action bean="productMoveFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="productMoveFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="moneyMoveForm" view="admin/moneyMoveForm">
		<render-actions>
			<action bean="moneyMoveFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="moneyMoveForm">
			<action bean="moneyMoveFormAction" method="bindAndValidate"/>
			<action bean="moneyMoveFormAction" method="submit"/>
		</transition>
		<transition on="editProductMoves" to="productMoveForm">
			<set attribute="moneyMoveId" value="${externalContext.requestParameterMap.idForRestore}" scope="flow"/>
		</transition>
		<exit-actions>
			<action bean="moneyMoveFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="orderForm" view="admin/orderForm">
		<render-actions>
			<action bean="orderFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="orderForm">
			<action bean="orderFormAction" method="bindAndValidate"/>
			<action bean="orderFormAction" method="submit"/>
		</transition>
		<transition on="editMoneyMoves" to="moneyMoveForm">
			<set attribute="orderId" value="${externalContext.requestParameterMap.idForRestore}" scope="flow"/>
		</transition>
		<exit-actions>
			<action bean="orderFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="priceListForm" view="admin/priceListForm">
		<render-actions>
			<action bean="priceListFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="priceListForm">
			<action bean="priceListFormAction" method="bindAndValidate"/>
			<action bean="priceListFormAction" method="submit"/>
		</transition>
		<transition on="editPrice" to="priceForm">
			<set attribute="priceId" value="${externalContext.requestParameterMap.idForRestore}" scope="flow"/>
		</transition>
		<exit-actions>
			<action bean="priceListFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="priceForm" view="admin/priceForm">
		<render-actions>
			<action bean="priceFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="priceForm">
			<action bean="priceFormAction" method="bindAndValidate"/>
			<action bean="priceFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="priceFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="warehouseForm" view="admin/warehouseForm">
		<render-actions>
			<action bean="warehouseFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="warehouseForm">
			<action bean="warehouseFormAction" method="bindAndValidate"/>
			<action bean="warehouseFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="warehouseFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="accountForm" view="admin/accountForm">
		<render-actions>
			<action bean="accountFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="accountForm">
			<action bean="accountFormAction" method="bindAndValidate"/>
			<action bean="accountFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="accountFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="contragentForm" view="admin/contragentForm">
		<render-actions>
			<action bean="contragentFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="contragentForm">
			<action bean="contragentFormAction" method="bindAndValidate"/>
			<action bean="contragentFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="contragentFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="addressForm" view="admin/addressForm">
		<render-actions>
			<action bean="addressFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="addressForm">
			<action bean="addressFormAction" method="bindAndValidate"/>
			<action bean="addressFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="addressFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="unitForm" view="admin/unitForm">
		<render-actions>
			<action bean="unitFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="unitForm">
			<action bean="unitFormAction" method="bindAndValidate"/>
			<action bean="unitFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="unitFormAction" method="bind"/>
		</exit-actions>
	</view-state>
	
	<view-state id="productTypeForm" view="admin/productTypeForm">
		<render-actions>
			<action bean="productTypeFormAction" method="setupForm"/>
		</render-actions>
		<transition on="stay" to="productTypeForm">
			<action bean="productTypeFormAction" method="bindAndValidate"/>
			<action bean="productTypeFormAction" method="submit"/>
		</transition>
		<exit-actions>
			<action bean="productTypeFormAction" method="bind"/>
		</exit-actions>
	</view-state>

	<end-state id="endView" view="end"/>
	<global-transitions>
		<transition on="exit" to="endView"/>
		<transition on="manageUnits" to="unitForm"/>
		<transition on="manageAddresses" to="addressForm"/>
		<transition on="manageProductTypes" to="productTypeForm"/>
		<transition on="manageContragents" to="contragentForm"/>
		<transition on="manageAccounts" to="accountForm"/>
		<transition on="manageWarehouses" to="warehouseForm"/>
		<transition on="managePriceLists" to="priceListForm"/>
		<transition on="managePrices" to="priceForm"/>
		<transition on="manageOrders" to="orderForm"/>
	</global-transitions>
	
	<import resource="admin-flow-beans.xml" />
</flow>